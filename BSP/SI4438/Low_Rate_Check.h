#ifndef LOW_RATE_CHECK_H__
#define LOW_RATE_CHECK_H__
#include "radio_hal.h"

//#define LOW_RATE_CHECK 

#define RX_CLK_PIN()     radio_hal_Gpio0Level()
#define RX_DATA_PIN()  radio_hal_Gpio2Level()
#define CHECK_MIN_RATE 4   //400us /bit :检测低速率连续码流宽度
#define CHECK_MAX_RATE 6   //600us /bit

#define MAX_CHECK_PREAMBLE_NUM 8
typedef enum
{
	START_CHECK, //启动检测
	CHECK_EQUALLYNUM,//检测连续码流宽度
	CHECK_VALID_NUM,//检测到的低速率有效码流个数
	CHECK_VALID,  //检测到有效的低速率前导码
	STOP_CHECK,
} CHECK_FLAG;  //低速率前导码检测状态位
typedef enum
{
	START_CONFIG,
	NEXT1_CONFIG,
	NEXT2_CONFIG,
	NEXT3_CONFIG,
	NEXT4_CONFIG,
	NEXT5_CONFIG,
	NEXT6_CONFIG,
	STOP_CONFIG,
	
}CONFIG_STATE;  //低速率SI4438寄存器配置状态
typedef enum
{
	HIGH_RATE=0,
	MEDIUM_RATE=1,
	LOW_RATE=2,
	LOW_LOW_RATE=3,	
} RATE_FLAG;  //速率状态位


typedef struct
{
	CHECK_FLAG CheckStartFlag;
	unsigned char Rate_100us;
	unsigned char ValidNum;
	unsigned char BitTmp;  //si4438 RX_DATA备份
	unsigned char channel;//当前信道
	RATE_FLAG CurrentRate; //芯片当前工作状态；
	unsigned char * pSetPropCmd;
	volatile unsigned int rx_tick_tmp;  //低速率状态系统TICK 备份
}PREAMBLE_LOW_RATE;

typedef struct
{
	unsigned char numOfBytes;
}CONFIG_LOW_RATE;
//中速率寄存器配置data rate=1.25K,Fdev=10k;bw=40k

#define DISABLE_HOP_TABLE       0x11, 0x50, 0x02,0x00,0x00,0x00
#define RF_MODEM_MOD_TYPE_12_M 0x11, 0x20, 0x0C, 0x00, 0x03, 0x00, 0x07, 0x00, 0xC3, 0x50, 0x05, 0xC9, 0xC3, 0x80, 0x00, 0x02
#define RF_MODEM_FREQ_DEV_0_1_M 0x11, 0x20, 0x01, 0x0C, 0xBB
#define MODEM_DECIMATION_CFG_M  0x11, 0x20, 0x02, 0x1e, 0x32, 0x20
#define RF_MODEM_BCR_OSR_1_7_M  0x11, 0x20, 0x07, 0x22, 0x02, 0xEE, 0x00, 0xAE, 0xC3, 0x00, 0x57
#define RF_MODEM_AFC_GEAR_4_M   0x11, 0x20, 0x05, 0x2e,  0x80, 0x01, 0x5D, 0x35,0x80
#define RF_MODEM_AGC_WINDOW_SIZE_3_M 0x11, 0x20, 0x03, 0x38, 0x11, 0xA4, 0xA4
#define RF_MODEM_OOK_PDTC_1_M 0x11, 0x20, 0x01, 0x40, 0x2B
#define MODEM_RAW_EYE_1_M   0x11, 0x20, 0x03, 0x45, 0x82, 0x05, 0x68

#define RF_MODEM_CHFLT_RX1_CHFLT_COE13_7_0_12_M 0x11, 0x21, 0x0C, 0x00, 0xA2, 0x81, 0x26, 0xAF, 0x3F, 0xEE, 0xC8, 0xC7, 0xDB, 0xF2, 0x02, 0x08
#define RF_MODEM_CHFLT_RX1_CHFLT_COE1_7_0_12_M 0x11, 0x21, 0x0C, 0x0C, 0x07, 0x03, 0x15, 0xFC, 0x0F, 0x00, 0xA2, 0x81, 0x26, 0xAF, 0x3F, 0xEE
#define RF_MODEM_CHFLT_RX2_CHFLT_COE7_7_0_12_M 0x11, 0x21, 0x0C, 0x18, 0xC8, 0xC7, 0xDB, 0xF2, 0x02, 0x08, 0x07, 0x03, 0x15, 0xFC, 0x0F, 0x00

#define PREAMBLE_TX_LENGTH_M 0x11, 0x10, 0x01, 0x00, 0x28
#define MID_RADIO_CONFIGURATION_DATA_ARRAY { \
0x10, RF_MODEM_MOD_TYPE_12_M,\
0x05, RF_MODEM_FREQ_DEV_0_1_M,\
0x06, MODEM_DECIMATION_CFG_M,\
0x0b, RF_MODEM_BCR_OSR_1_7_M,\
0x09, RF_MODEM_AFC_GEAR_4_M,\
0x07, RF_MODEM_AGC_WINDOW_SIZE_3_M,\
0x05, RF_MODEM_OOK_PDTC_1_M,\
0x07, MODEM_RAW_EYE_1_M,\
0x10, RF_MODEM_CHFLT_RX1_CHFLT_COE13_7_0_12_M, \
0x10, RF_MODEM_CHFLT_RX1_CHFLT_COE1_7_0_12_M, \
0x10, RF_MODEM_CHFLT_RX2_CHFLT_COE7_7_0_12_M, \
0x05, PREAMBLE_TX_LENGTH_M, \
0x00 \
}

/*
//低速率寄存器配置data rate=0.3125K,Fdev=10k;bw=40k
#define RF_MODEM_MOD_TYPE_12_L 0x11, 0x20, 0x0C, 0x00, 0x03, 0x00, 0x07, 0x00, 0x30, 0xC0, 0x05, 0xC9, 0xC3, 0x80, 0x00, 0x02
#define RF_MODEM_FREQ_DEV_0_1_L 0x11, 0x20, 0x01, 0x0C, 0xBB
#define MODEM_DECIMATION_CFG_L  0x11, 0x20, 0x02, 0x1e, 0x36, 0x21
#define RF_MODEM_BCR_OSR_1_7_L  0x11, 0x20, 0x07, 0x22, 0x02, 0xEF, 0x00, 0xAE, 0x7C, 0x00, 0x57

#define RF_MODEM_AFC_GEAR_4_L   0x11, 0x20, 0x05, 0x2e,  0x80, 0x01, 0x5D, 0x35,0x80
#define RF_MODEM_AGC_WINDOW_SIZE_3_L 0x11, 0x20, 0x03, 0x38, 0x11, 0xA4, 0xA4
#define RF_MODEM_OOK_PDTC_1_L 0x11, 0x20, 0x01, 0x40, 0x2B
#define MODEM_RAW_EYE_1_L   0x11, 0x20, 0x03, 0x45, 0x82, 0x05, 0x68

#define RF_MODEM_CHFLT_RX1_CHFLT_COE13_7_0_12_L 0x11, 0x21, 0x0C, 0x00, 0xA2, 0x81, 0x26, 0xAF, 0x3F, 0xEE, 0xC8, 0xC7, 0xDB, 0xF2, 0x02, 0x08
#define RF_MODEM_CHFLT_RX1_CHFLT_COE1_7_0_12_L 0x11, 0x21, 0x0C, 0x0C, 0x07, 0x03, 0x15, 0xFC, 0x0F, 0x00, 0xA2, 0x81, 0x26, 0xAF, 0x3F, 0xEE
#define RF_MODEM_CHFLT_RX2_CHFLT_COE7_7_0_12_L 0x11, 0x21, 0x0C, 0x18, 0xC8, 0xC7, 0xDB, 0xF2, 0x02, 0x08, 0x07, 0x03, 0x15, 0xFC, 0x0F, 0x00
*/
	//低速率寄存器配置data rate=0.5K,Fdev=10k;bw=40k
#define DISABLE_HOP_TABLE       0x11, 0x50, 0x02,0x00,0x00,0x00
#define RF_MODEM_MOD_TYPE_12_L 0x11, 0x20, 0x0C, 0x00, 0x03, 0x00, 0x07, 0x00, 0x4E, 0x20, 0x05, 0xC9, 0xC3, 0x80, 0x00, 0x02
#define RF_MODEM_FREQ_DEV_0_1_L 0x11, 0x20, 0x01, 0x0C, 0xBB
#define MODEM_DECIMATION_CFG_L  0x11, 0x20, 0x02, 0x1e, 0x34, 0x21
#define RF_MODEM_BCR_OSR_1_7_L  0x11, 0x20, 0x07, 0x22, 0x03, 0xAA, 0x00, 0x8B, 0xCF, 0x00, 0x46

#define RF_MODEM_AFC_GEAR_4_L   0x11, 0x20, 0x05, 0x2e,  0x80, 0x01, 0x5D, 0x35,0x80
#define RF_MODEM_AGC_WINDOW_SIZE_3_L 0x11, 0x20, 0x03, 0x38, 0x11, 0xCD, 0xCD
#define RF_MODEM_OOK_PDTC_1_L 0x11, 0x20, 0x01, 0x40, 0x2B
#define MODEM_RAW_EYE_1_L   0x11, 0x20, 0x03, 0x45, 0x82, 0x05, 0x68
	
#define RF_MODEM_CHFLT_RX1_CHFLT_COE13_7_0_12_L 0x11, 0x21, 0x0C, 0x00, 0xA2, 0x81, 0x26, 0xAF, 0x3F, 0xEE, 0xC8, 0xC7, 0xDB, 0xF2, 0x02, 0x08
#define RF_MODEM_CHFLT_RX1_CHFLT_COE1_7_0_12_L 0x11, 0x21, 0x0C, 0x0C, 0x07, 0x03, 0x15, 0xFC, 0x0F, 0x00, 0xA2, 0x81, 0x26, 0xAF, 0x3F, 0xEE
#define RF_MODEM_CHFLT_RX2_CHFLT_COE7_7_0_12_L 0x11, 0x21, 0x0C, 0x18, 0xC8, 0xC7, 0xDB, 0xF2, 0x02, 0x08, 0x07, 0x03, 0x15, 0xFC, 0x0F, 0x00

#define PREAMBLE_TX_LENGTH_L 0x11, 0x10, 0x01, 0x00, 0x28

#define LOW_RADIO_CONFIGURATION_DATA_ARRAY { \
0x10, RF_MODEM_MOD_TYPE_12_L,\
0x05, RF_MODEM_FREQ_DEV_0_1_L,\
0x06, MODEM_DECIMATION_CFG_L,\
0x0b, RF_MODEM_BCR_OSR_1_7_L,\
0x09, RF_MODEM_AFC_GEAR_4_L,\
0x07, RF_MODEM_AGC_WINDOW_SIZE_3_L,\
0x05, RF_MODEM_OOK_PDTC_1_L,\
0x07, MODEM_RAW_EYE_1_L,\
0x10, RF_MODEM_CHFLT_RX1_CHFLT_COE13_7_0_12_L, \
0x10, RF_MODEM_CHFLT_RX1_CHFLT_COE1_7_0_12_L, \
0x10, RF_MODEM_CHFLT_RX2_CHFLT_COE7_7_0_12_L, \
0x05, PREAMBLE_TX_LENGTH_L, \
0x00 \
}
//低速率寄存器配置data rate=0.2K,Fdev=10k;bw=40k
#define RF_MODEM_MOD_TYPE_12_L_L 0x11, 0x20, 0x0C, 0x00, 0x03, 0x00, 0x07, 0x00, 0x1F, 0x40, 0x05, 0xC9, 0xC3, 0x80, 0x00, 0x02
#define RF_MODEM_FREQ_DEV_0_1_L_L 0x11, 0x20, 0x01, 0x0C, 0xBB
#define MODEM_DECIMATION_CFG_L_L  0x11, 0x20, 0x02, 0x1e, 0x38, 0x21
#define RF_MODEM_BCR_OSR_1_7_L_L  0x11, 0x20, 0x07, 0x22, 0x02, 0x4A, 0x00, 0xDF, 0xB2, 0x00, 0x70

#define RF_MODEM_AFC_GEAR_4_L_L   0x11, 0x20, 0x04, 0x2e,  0x80, 0x01, 0x5D, 0x35
#define RF_MODEM_AGC_WINDOW_SIZE_3_L_L 0x11, 0x20, 0x03, 0x38, 0x11, 0x80, 0x80
#define RF_MODEM_OOK_PDTC_1_L_L 0x11, 0x20, 0x01, 0x40, 0x2B
#define MODEM_RAW_EYE_1_L_L   0x11, 0x20, 0x03, 0x45, 0x82, 0x05, 0x68

#define RF_MODEM_CHFLT_RX1_CHFLT_COE13_7_0_12_L_L 0x11, 0x21, 0x0C, 0x00, 0xA2, 0x81, 0x26, 0xAF, 0x3F, 0xEE, 0xC8, 0xC7, 0xDB, 0xF2, 0x02, 0x08
#define RF_MODEM_CHFLT_RX1_CHFLT_COE1_7_0_12_L_L 0x11, 0x21, 0x0C, 0x0C, 0x07, 0x03, 0x15, 0xFC, 0x0F, 0x00, 0xA2, 0x81, 0x26, 0xAF, 0x3F, 0xEE
#define RF_MODEM_CHFLT_RX2_CHFLT_COE7_7_0_12_L_L 0x11, 0x21, 0x0C, 0x18, 0xC8, 0xC7, 0xDB, 0xF2, 0x02, 0x08, 0x07, 0x03, 0x15, 0xFC, 0x0F, 0x00

#define PREAMBLE_TX_LENGTH_L_L 0x11, 0x10, 0x01, 0x00, 0x28

#define LOW_LOW_RADIO_CONFIGURATION_DATA_ARRAY { \
0x10, RF_MODEM_MOD_TYPE_12_L_L,\
0x05, RF_MODEM_FREQ_DEV_0_1_L_L,\
0x06, MODEM_DECIMATION_CFG_L_L,\
0x0b, RF_MODEM_BCR_OSR_1_7_L_L,\
0x08, RF_MODEM_AFC_GEAR_4_L_L,\
0x07, RF_MODEM_AGC_WINDOW_SIZE_3_L_L,\
0x05, RF_MODEM_OOK_PDTC_1_L_L,\
0x07, MODEM_RAW_EYE_1_L_L,\
0x10, RF_MODEM_CHFLT_RX1_CHFLT_COE13_7_0_12_L_L, \
0x10, RF_MODEM_CHFLT_RX1_CHFLT_COE1_7_0_12_L_L, \
0x10, RF_MODEM_CHFLT_RX2_CHFLT_COE7_7_0_12_L_L, \
0x05, PREAMBLE_TX_LENGTH_L_L, \
0x00 \
}

//高速率寄存器配置
#define RF_MODEM_MOD_TYPE_12_H 0x11, 0x20, 0x0C, 0x00, 0x03, 0x00, 0x07, 0x06, 0x1A, 0x80, 0x05, 0xC9, 0xC3, 0x80, 0x00, 0x06
#define RF_MODEM_FREQ_DEV_0_1_H 0x11, 0x20, 0x01, 0x0C, 0xD4
#define MODEM_DECIMATION_CFG_H  0x11, 0x20, 0x02, 0x1e, 0x20, 0x20
#define RF_MODEM_BCR_OSR_1_7_H  0x11, 0x20, 0x07, 0x22, 0x01, 0x77, 0x01, 0x5D, 0x86, 0x00, 0xAF
#define RF_MODEM_AFC_GEAR_4_H   0x11, 0x20, 0x05, 0x2e,  0x80, 0x1D, 0x10, 0x04 ,0x80
#define RF_MODEM_AGC_WINDOW_SIZE_3_H 0x11, 0x20, 0x03, 0x38, 0x11, 0x52, 0x52
#define RF_MODEM_OOK_PDTC_1_H 0x11, 0x20, 0x01, 0x40, 0x2A
#define MODEM_RAW_EYE_1_H    0x11, 0x20, 0x03, 0x45,0x83, 0x00, 0xD8

#define RF_MODEM_CHFLT_RX1_CHFLT_COE13_7_0_12_H 0x11, 0x21, 0x0C, 0x00, 0xA2, 0x81, 0x26, 0xAF, 0x3F, 0xEE, 0xC8, 0xC7, 0xDB, 0xF2, 0x02, 0x08
#define RF_MODEM_CHFLT_RX1_CHFLT_COE1_7_0_12_H 0x11, 0x21, 0x0C, 0x0C, 0x07, 0x03, 0x15, 0xFC, 0x0F, 0x00, 0xA2, 0x81, 0x26, 0xAF, 0x3F, 0xEE
#define RF_MODEM_CHFLT_RX2_CHFLT_COE7_7_0_12_H 0x11, 0x21, 0x0C, 0x18, 0xC8, 0xC7, 0xDB, 0xF2, 0x02, 0x08, 0x07, 0x03, 0x15, 0xFC, 0x0F, 0x00
#define PREAMBLE_TX_LENGTH_H 0x11, 0x10, 0x01, 0x00, 0x50


#define HIGH_RADIO_CONFIGURATION_DATA_ARRAY { \
0x10, RF_MODEM_MOD_TYPE_12_H,\
0x05, RF_MODEM_FREQ_DEV_0_1_H,\
0x06, MODEM_DECIMATION_CFG_H,\
0x0b, RF_MODEM_BCR_OSR_1_7_H,\
0x09, RF_MODEM_AFC_GEAR_4_H,\
0x07, RF_MODEM_AGC_WINDOW_SIZE_3_H,\
0x05, RF_MODEM_OOK_PDTC_1_H,\
0x07, MODEM_RAW_EYE_1_H,\
0x10, RF_MODEM_CHFLT_RX1_CHFLT_COE13_7_0_12_H, \
0x10, RF_MODEM_CHFLT_RX1_CHFLT_COE1_7_0_12_H, \
0x10, RF_MODEM_CHFLT_RX2_CHFLT_COE7_7_0_12_H, \
0x05, PREAMBLE_TX_LENGTH_H, \
0x00 \
}
extern CONFIG_LOW_RATE ConfigRate;
extern const unsigned char LowRateRadioComfiguration[];
extern volatile PREAMBLE_LOW_RATE PreambleCheck;
extern void CheckLowRatePreamble(void);
extern void SetLowRate(void);
extern void SetMediumRate(void);
extern void SetHighRate(void);

extern void CLK_EXTI_Configuration(FunctionalState State);


#endif


